<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="style.css"/>
    <script data-require="jquery@*" data-semver="3.1.1" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script>
        const api = "http://localhost:8080";
        $(loadReceipts())

        function loadReceipts() {
            $.getJSON(api + "/receipts", function(receipts){
                $("#receiptList").empty();
                for(var i = receipts.length - 1; i >= 0; i--) {
                    var receipt = receipts[i];
                    $(`<div class="receipt">
                            Time: ${receipt.created}<br>
                            Name: ${receipt.merchantName}<br>
                            Amount: $${receipt.value}<br>
                            <div>
                                <span class="receiptTag" id = ${receipt.id}>Tags - 
                                    <input type="text" placeholder="Add tag">
                                    <input type="button" value="Add+">
                                </span>
                            </div>
                        </div>`
                    ).appendTo($("#receiptList"));

                    receipt.tags.forEach(function(tag) {
                        var button = document.createElement('input');
                        button.type = "button"
                        button.value = tag+"  x"
                        button.name = receipt.id
                        button.addEventListener('click', function(){ untag(tag, this) });
                        document.getElementById(receipt.id).appendChild(button)
                    });
                }
            })
        }

        function tag(tag, button) {

        }

        function untag(tag, button) {
            $.ajax({
                url: api+"/tags/"+tag,
                type: "PUT",
                data: JSON.stringify(parseInt(button.name)),
                contentType: "application/json; charset=utf-8",
                dataType:    "json",
                success: function(){
                    loadReceipts();
                },
            });
        }

        function addReceipt() {
            $.ajax({
                url:         api+"/receipts",
                type:        "POST",
                data:        JSON.stringify({ merchant: $("#inputMerchant").val(), amount: parseInt($("#inputAmount").val()) }),
                contentType: "application/json; charset=utf-8",
                dataType:    "json",
                success: function(){
                    loadReceipts();
                },
            });            
        }

        function toggleInputBox() {
            $("#inputBox").toggle();
        }
    </script>
</head>

<body>
<DIV id="container">
    <h1>My receipts</h1>
    <div class="button" onclick="toggleInputBox()">+</div>
    <div id = "inputBox">
        <input type="text" id="inputMerchant" placeholder="Merchant">
        <input type="text" id="inputAmount" placeholder="Amount">
        <input type="button" value="Cancel" onclick = "toggleInputBox()">
        <input type="button" value="Save" onclick = "addReceipt()">
    </div>

    <div id="receiptList"></div>
</DIV>
</body>

</html>